generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String     @id @default(uuid())
  name            String
  email           String     @unique
  password        String
  isEmailVerified Boolean    @default(false)
  otp             String?
  otpExpires      DateTime?
  role            UserRole   @default(USER) // "USER" | "ADMIN"
  status          UserStatus @default(ACTIVE)

  projects     Project[]
  learningLogs LearningLog[]
  expenses     Expense[]
  notes        Note[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

model Project {
  id          String        @id @default(uuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime?
  clientName  String
  status      ProjectStatus

  userId String
  user   User   @relation(fields: [userId], references: [id])

  tasks     Task[]
  notes     Note[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, userId])
}

enum ProjectStatus {
  PLANNED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
}

model Task {
  id String @id @default(uuid())

  projectId String
  project   Project @relation(fields: [projectId], references: [id])

  title       String
  description String?
  priority    Priority // "low" | "medium" | "high"
  status      TaskStatus @default(pending) // "pending" | "in-progress" | "done"
  dueDate     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TaskStatus {
  pending
  in_progress @map("in-progress")
  done
}

enum Priority {
  low
  medium
  high
}

model LearningLog {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  topic      String
  hoursSpent Float
  difficulty String? // "easy" | "medium" | "hard"
  notes      String?
  date       DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Expense {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  type        String // "income" | "expense"
  category    String
  amount      Float
  date        DateTime
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Note {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  text             String
  tags             String[]
  relatedProjectId String?
  relatedProject   Project? @relation(fields: [relatedProjectId], references: [id])

  date DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
